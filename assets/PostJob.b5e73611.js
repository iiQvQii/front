import{N as k,aV as M,O,u as R,s as Z,r as g,a as Q,P as h,p as $,o as p,S as q,w as d,l as A,f as a,T as u,e as s,bv as J,j as f,k as U,t as H,i as j,W as b,aM as K,d as V,aK as x,F as z,b8 as L,U as X,X as Y,Y as G,bt as ee,aJ as te,_ as I}from"./index.edeae69a.js";import{d as n,a as y,Q as le,b as oe}from"./data-zh.4fb3324c.js";import{Q as S}from"./QSelect.a75092c0.js";import{Q as se}from"./QFile.ea654cd3.js";import{Q as ie}from"./QImg.68f7e976.js";import{Q as ae}from"./QForm.e93bf988.js";import"./QChip.74d8cce9.js";const re={class:"q-pa-md",style:{"min-width":"500px"}},ne={class:"row items-center justify-end"},de={class:"q-gutter-sm"},ue={style:{"font-size":"1rem",margin:"0"}},ce={key:0},me={class:"q-pa-md flex row"},_e={__name:"PostJob",setup(pe){const{locale:c}=k({useScope:"global"}),{t:r}=k();M();const T=O(),C=R(),{role:D,isHost:P}=Z(C),v=g(""),w=g(!1);g(!0);const i=Q({city:"",district:""}),t=Q({_id:"",title:"",date:{},date_from:"",date_to:"",welfare:[],city:"",district:"",address:"",zipcode:"",role:D.value,description:"?",photos:[],question:"1. \u8ACB\u554F\u4F60\u70BA\u4EC0\u9EBC\u60F3\u8981\u4F86",week_hours:10,is_shown:!0});h(()=>t.date,()=>{v.value=t.date.from+"~"+t.date.to});const B=$(()=>[{label:r("accommodation"),value:"accommodation"},{label:r("vehicle"),value:"vehicle"},{label:r("pocket_money"),value:"pocket_money"},{label:r("insurance"),value:"insurance"},{label:r("free_course"),value:"free_course"},{label:r("meal"),value:"meal"}]),m=Q({title:[e=>!!e||r("required"),e=>e.length>=2&&e.length<=30||"\u540D\u7A31\u9577\u5EA6\u70BA 2 \u5230 30 \u500B\u5B57"],address:[e=>!!e||r("required"),e=>e.length>=5||"\u8ACB\u586B\u5BEB\u6B63\u78BA\u8A73\u7D30\u5730\u5740\u8CC7\u8A0A"],required:[e=>!!e||r("required")]}),E=$(()=>c.value==="zh-TW"?n.counties:y.counties),F=$(()=>{if(c.value==="zh-TW"&&t.city){const e=n.counties.findIndex(l=>l===t.city);return n.districts[e][0]}else if(c.value==="en-US"&&t.city){const e=y.counties.findIndex(l=>l===t.city);return console.log(t.city),console.log(e),y.districts[e][0]||""}else return null});h(()=>c.value,()=>{t.city="",t.district=""}),h(()=>t.city,()=>{if(t.district="",c.value==="zh-TW"){const e=n.counties.findIndex(l=>l===t.city);e>-1&&(i.city=e)}else{const e=y.counties.findIndex(l=>l===t.city);e>-1&&(i.city=e)}}),h(()=>t.district,()=>{if(c.value==="zh-TW"){console.log(i.city);const e=n.districts[i.city][0].findIndex(l=>l===t.district);console.log(i.city),console.log(e),e>-1&&(i.district=e,t.zipcode=n.districts[i.city][1][e])}else{const e=y.districts[i.city][0].findIndex(l=>l===t.district);e>-1&&(i.district=e,t.zipcode=n.districts[i.city][1][e])}});const N=async()=>{w.value=!0;try{t.date_from=t.date.from,t.date_to=t.date.to,c.value==="en-US"&&(t.city=n.counties[i.city],t.district=n.districts[i.city][0][i.district]);const e=new FormData;for(const l in t)if(l==="photos"){for(let o=0;o<t[l].length;o++)e.append(l,t[l][o]);console.log(t[l])}else e.append(l,t[l]);await te.post("/jobs",e),await I.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"}),T.push("/admin/jobs")}catch(e){console.log(e),I.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError&&e.response.data?e.response.data.message:"\u767C\u751F\u932F\u8AA4"})}w.value=!1};return(e,l)=>(p(),q(A,{id:"post_jobs",class:"flex flex-center column"},{default:d(()=>[a("h4",null,u(e.$t("new_jobs")),1),a("div",re,[s(ae,{autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false",onSubmit:Y(N,["prevent"])},{default:d(()=>[s(J,{modelValue:t.is_shown,"onUpdate:modelValue":l[0]||(l[0]=o=>t.is_shown=o),label:t.is_shown?e.$t("is_shown"):e.$t("is_not_shown")},null,8,["modelValue","label"]),s(f,{outlined:"",modelValue:t.title,"onUpdate:modelValue":l[1]||(l[1]=o=>t.title=o),label:e.$t("job_title")+"*",rules:m.title},null,8,["modelValue","label","rules"]),s(f,{outlined:"",modelValue:v.value,"onUpdate:modelValue":l[3]||(l[3]=o=>v.value=o),rules:m.required,label:e.$t("job_time")},{append:d(()=>[s(U,{name:"event",class:"cursor-pointer"},{default:d(()=>[s(le,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:d(()=>[s(oe,{modelValue:t.date,"onUpdate:modelValue":l[2]||(l[2]=o=>t.date=o),range:""},{default:d(()=>[a("div",ne,[H(s(j,{label:"Close",color:"primary",flat:""},null,512),[[G]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules","label"]),s(S,{outlined:"",modelValue:t.city,"onUpdate:modelValue":l[4]||(l[4]=o=>t.city=o),options:b(E),label:e.$t("city")+"*","emit-value":"","lazy-rules":"",rules:m.required},null,8,["modelValue","options","label","rules"]),s(S,{outlined:"",modelValue:t.district,"onUpdate:modelValue":l[5]||(l[5]=o=>t.district=o),options:b(F),label:e.$t("district")+"*","emit-value":"",rules:m.required},null,8,["modelValue","options","label","rules"]),K(" "+u(i.city),1),s(f,{outlined:"",type:"text",modelValue:t.address,"onUpdate:modelValue":l[6]||(l[6]=o=>t.address=o),label:e.$t("address")+"*","lazy-rules":"",rules:m.address},null,8,["modelValue","label","rules"]),a("h5",null,u(e.$t("job_welfare")),1),a("div",de,[(p(!0),V(z,null,x(b(B),(o,_)=>(p(),q(ee,{key:_,modelValue:t.welfare,"onUpdate:modelValue":l[7]||(l[7]=W=>t.welfare=W),val:o.value,label:o.label},null,8,["modelValue","val","label"]))),128))]),a("h5",null,u(e.$t("job_week_hours")),1),s(f,{modelValue:t.week_hours,"onUpdate:modelValue":l[8]||(l[8]=o=>t.week_hours=o),modelModifiers:{number:!0},type:"number",filled:"",rules:m.required},{append:d(()=>[a("p",ue,u(e.$t("hours_a_week")),1)]),_:1},8,["modelValue","rules"]),a("h5",null,u(e.$t("job_description")),1),s(b(L),{content:t.description,"onUpdate:content":l[9]||(l[9]=o=>t.description=o),contentType:"html",theme:"snow",toolbar:"minimal",placeholder:e.$t("write_down_what_the_helpers_need_to_do")},null,8,["content","placeholder"]),b(P)?(p(),V("h5",ce,u(e.$t("photos_host")),1)):X("",!0),s(se,{color:"primary",accept:".jpg, image/*","max-files":3,filled:"",multiple:"",modelValue:t.photos,"onUpdate:modelValue":l[10]||(l[10]=o=>t.photos=o),label:e.$t("upload_file"),hint:"\u6700\u591A\u4E0A\u50B33\u5F35"},{prepend:d(()=>[s(U,{name:"cloud_upload"})]),_:1},8,["modelValue","label"]),a("div",me,[(p(!0),V(z,null,x(e.photos,(o,_)=>(p(),V("div",{class:"col-6 q-pa-xs",key:_},[s(ie,{src:o,ratio:4/3,"spinner-color":"white"},null,8,["src"])]))),128))]),a("h5",null,u(e.$t("job_question")),1),s(f,{modelValue:t.question,"onUpdate:modelValue":l[11]||(l[11]=o=>t.question=o),filled:"",type:"textarea",hint:e.$t("job_question_hint")},null,8,["modelValue","hint"]),s(j,{class:"full-width",color:"primary",label:e.$t("submit"),type:"submit",loading:w.value},null,8,["label","loading"])]),_:1},8,["onSubmit"])])]),_:1}))}};export{_e as default};
