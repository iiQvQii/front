import{X as k,aN as O,Y as R,u as A,s as M,r as g,a as Q,p as h,D as $,o as p,Z as q,w as u,l as H,f as a,t as n,e as s,bv as J,j as f,k as U,E as L,i as j,a0 as b,aS as x,d as v,aP as z,F as I,bd as X,_ as Y,a1 as G,a2 as K,bt as ee,aQ as te,aO as le,a4 as S}from"./index.c53e1e06.js";import{d,a as y,Q as oe,b as se}from"./data-zh.0cb8ff3e.js";import{Q as T}from"./QSelect.827642bc.js";import{Q as ie}from"./QFile.bcfdc53f.js";import{Q as ae}from"./QForm.e28fb361.js";import"./QChip.8a9934e9.js";const re={class:"q-pa-md",style:{"min-width":"500px"}},ne={class:"row items-center justify-end"},de={class:"q-gutter-sm"},ue={style:{"font-size":"1rem",margin:"0"}},ce={key:0},me={class:"q-pa-md flex row"},Ve={__name:"PostJob",setup(pe){const{locale:c}=k({useScope:"global"}),{t:r}=k();O();const C=R(),D=A(),{role:E,isHost:P}=M(D),w=g(""),V=g(!1);g(!0);const i=Q({city:"",district:""}),t=Q({_id:"",title:"",date:{},date_from:"",date_to:"",welfare:[],city:"",district:"",address:"",zipcode:"",role:E.value,description:"?",photos:[],question:"1. \u8ACB\u554F\u4F60\u70BA\u4EC0\u9EBC\u60F3\u8981\u4F86",week_hours:10,is_shown:!0});h(()=>t.date,()=>{w.value=t.date.from+"~"+t.date.to});const B=$(()=>[{label:r("accommodation"),value:"accommodation"},{label:r("vehicle"),value:"vehicle"},{label:r("pocket_money"),value:"pocket_money"},{label:r("insurance"),value:"insurance"},{label:r("free_course"),value:"free_course"},{label:r("meal"),value:"meal"}]),m=Q({title:[e=>!!e||r("required"),e=>e.length>=2&&e.length<=30||"\u540D\u7A31\u9577\u5EA6\u70BA 2 \u5230 30 \u500B\u5B57"],address:[e=>!!e||r("required"),e=>e.length>=5||"\u8ACB\u586B\u5BEB\u6B63\u78BA\u8A73\u7D30\u5730\u5740\u8CC7\u8A0A"],required:[e=>!!e||r("required")]}),F=$(()=>c.value==="zh-TW"?d.counties:y.counties),N=$(()=>{if(c.value==="zh-TW"&&t.city){const e=d.counties.findIndex(l=>l===t.city);return d.districts[e][0]}else if(c.value==="en-US"&&t.city){const e=y.counties.findIndex(l=>l===t.city);return console.log(t.city),console.log(e),y.districts[e][0]||""}else return null});h(()=>c.value,()=>{t.city="",t.district=""}),h(()=>t.city,()=>{if(t.district="",c.value==="zh-TW"){const e=d.counties.findIndex(l=>l===t.city);e>-1&&(i.city=e)}else{const e=y.counties.findIndex(l=>l===t.city);e>-1&&(i.city=e)}}),h(()=>t.district,()=>{if(c.value==="zh-TW"){console.log(i.city);const e=d.districts[i.city][0].findIndex(l=>l===t.district);console.log(i.city),console.log(e),e>-1&&(i.district=e,t.zipcode=d.districts[i.city][1][e])}else{const e=y.districts[i.city][0].findIndex(l=>l===t.district);e>-1&&(i.district=e,t.zipcode=d.districts[i.city][1][e])}});const W=async()=>{V.value=!0;try{t.date_from=t.date.from,t.date_to=t.date.to,c.value==="en-US"&&(t.city=d.counties[i.city],t.district=d.districts[i.city][0][i.district]);const e=new FormData;for(const l in t)if(l==="photos")for(let o=0;o<t[l].length;o++)e.append(l,t[l][o]);else if(l==="welfare")for(let o=0;o<t[l].length;o++)e.append(l,t[l][o]);else e.append(l,t[l]);await le.post("/jobs",e),await S.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"}),C.push("/admin/jobs")}catch(e){console.log(e),S.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError&&e.response.data?e.response.data.message:"\u767C\u751F\u932F\u8AA4"})}V.value=!1};return(e,l)=>(p(),q(H,{id:"post_jobs",class:"flex flex-center column"},{default:u(()=>[a("h4",null,n(e.$t("new_jobs")),1),a("div",re,[s(ae,{autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false",onSubmit:G(W,["prevent"])},{default:u(()=>[s(J,{modelValue:t.is_shown,"onUpdate:modelValue":l[0]||(l[0]=o=>t.is_shown=o),label:t.is_shown?e.$t("is_shown"):e.$t("is_not_shown")},null,8,["modelValue","label"]),s(f,{outlined:"",modelValue:t.title,"onUpdate:modelValue":l[1]||(l[1]=o=>t.title=o),label:e.$t("job_title")+"*",rules:m.title},null,8,["modelValue","label","rules"]),s(f,{outlined:"",modelValue:w.value,"onUpdate:modelValue":l[3]||(l[3]=o=>w.value=o),rules:m.required,label:e.$t("job_time")},{append:u(()=>[s(U,{name:"event",class:"cursor-pointer"},{default:u(()=>[s(oe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:u(()=>[s(se,{modelValue:t.date,"onUpdate:modelValue":l[2]||(l[2]=o=>t.date=o),range:""},{default:u(()=>[a("div",ne,[L(s(j,{label:"Close",color:"primary",flat:""},null,512),[[K]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules","label"]),s(T,{outlined:"",modelValue:t.city,"onUpdate:modelValue":l[4]||(l[4]=o=>t.city=o),options:b(F),label:e.$t("city")+"*","emit-value":"","lazy-rules":"",rules:m.required},null,8,["modelValue","options","label","rules"]),s(T,{outlined:"",modelValue:t.district,"onUpdate:modelValue":l[5]||(l[5]=o=>t.district=o),options:b(N),label:e.$t("district")+"*","emit-value":"",rules:m.required},null,8,["modelValue","options","label","rules"]),x(" "+n(i.city),1),s(f,{outlined:"",type:"text",modelValue:t.address,"onUpdate:modelValue":l[6]||(l[6]=o=>t.address=o),label:e.$t("address")+"*","lazy-rules":"",rules:m.address},null,8,["modelValue","label","rules"]),a("h5",null,n(e.$t("job_welfare")),1),a("div",de,[(p(!0),v(I,null,z(b(B),(o,_)=>(p(),q(ee,{key:_,modelValue:t.welfare,"onUpdate:modelValue":l[7]||(l[7]=Z=>t.welfare=Z),val:o.value,label:o.label},null,8,["modelValue","val","label"]))),128))]),x(" "+n(t.welfare),1),a("h5",null,n(e.$t("job_week_hours")),1),s(f,{modelValue:t.week_hours,"onUpdate:modelValue":l[8]||(l[8]=o=>t.week_hours=o),modelModifiers:{number:!0},type:"number",filled:"",rules:m.required},{append:u(()=>[a("p",ue,n(e.$t("hours_a_week")),1)]),_:1},8,["modelValue","rules"]),a("h5",null,n(e.$t("job_description")),1),s(b(X),{content:t.description,"onUpdate:content":l[9]||(l[9]=o=>t.description=o),contentType:"html",theme:"snow",toolbar:"minimal",placeholder:e.$t("write_down_what_the_helpers_need_to_do")},null,8,["content","placeholder"]),b(P)?(p(),v("h5",ce,n(e.$t("photos_host")),1)):Y("",!0),s(ie,{color:"primary",accept:".jpg, image/*","max-files":3,filled:"",multiple:"",modelValue:t.photos,"onUpdate:modelValue":l[10]||(l[10]=o=>t.photos=o),label:e.$t("upload_file"),hint:"\u6700\u591A\u4E0A\u50B33\u5F35"},{prepend:u(()=>[s(U,{name:"cloud_upload"})]),_:1},8,["modelValue","label"]),a("div",me,[(p(!0),v(I,null,z(e.photos,(o,_)=>(p(),v("div",{class:"col-6 q-pa-xs",key:_},[s(te,{src:o,ratio:4/3,"spinner-color":"white"},null,8,["src"])]))),128))]),a("h5",null,n(e.$t("job_question")),1),s(f,{modelValue:t.question,"onUpdate:modelValue":l[11]||(l[11]=o=>t.question=o),filled:"",type:"textarea",hint:e.$t("job_question_hint")},null,8,["modelValue","hint"]),s(j,{class:"full-width",color:"primary",label:e.$t("submit"),type:"submit",loading:V.value},null,8,["label","loading"])]),_:1},8,["onSubmit"])])]),_:1}))}};export{Ve as default};
