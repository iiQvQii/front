import{Z as $,aN as Z,$ as O,u as R,s as A,r as g,j as q,w as h,B as Q,a0 as r,k as p,a1 as k,p as d,Q as L,t as s,x as c,n as i,aL as M,bw as H,a3 as f,C as j,a6 as J,I as G,y as x,a5 as b,m as v,aP as U,F as z,a2 as K,a7 as X,a8 as Y,bu as ee,bf as te,v as le,aO as oe,aa as I}from"./index.7e440d76.js";import{Q as se}from"./QPopupProxy.47f588ad.js";import{Q as S}from"./QSelect.de67e8e0.js";import{Q as ie}from"./QFile.b98a90e7.js";import{Q as ae}from"./QForm.af97a481.js";import{d as y}from"./data-en.7b4ff248.js";const ne={class:"q-pa-xl q-mx-auto"},re={class:"text-center"},de={class:"q-mx-auto form_container"},ue={class:"row justify-end"},ce={class:"col q-pb-md text-right text-weight-bold"},me={class:"row items-center justify-end"},pe={class:"q-gutter-sm"},fe={style:{"font-size":"1rem",margin:"0"}},be={key:0},ye={class:"q-pa-md flex row"},Qe={__name:"PostJob",setup(he){const{locale:u}=$({useScope:"global"}),{t:n}=$();Z();const C=O(),T=R(),{role:B,isHost:D}=A(T),w=g(""),V=g(!1);g(!0);const a=q({city:"",district:""}),t=q({_id:"",title:"",date:{},date_from:"",date_to:"",welfare:[],city:"",district:"",address:"",zipcode:"",role:B.value,description:"",photos:[],question:"",week_hours:20,is_shown:!0});h(()=>t.date,()=>{w.value=t.date.from+"~"+t.date.to});const P=Q(()=>[{label:n("accommodation"),value:"accommodation"},{label:n("vehicle"),value:"vehicle"},{label:n("pocket_money"),value:"pocket_money"},{label:n("insurance"),value:"insurance"},{label:n("free_course"),value:"free_course"},{label:n("meal"),value:"meal"}]),m=q({title:[e=>!!e||n("required"),e=>e.length>=2&&e.length<=30||"\u540D\u7A31\u9577\u5EA6\u70BA 2 \u5230 30 \u500B\u5B57"],address:[e=>!!e||n("required"),e=>e.length>=5||"\u8ACB\u586B\u5BEB\u6B63\u78BA\u8A73\u7D30\u5730\u5740\u8CC7\u8A0A"],required:[e=>!!e||n("required")]}),E=Q(()=>u.value==="zh-TW"?r.counties:y.counties),F=Q(()=>{if(u.value==="zh-TW"&&t.city){const e=r.counties.findIndex(l=>l===t.city);return r.districts[e][0]}else if(u.value==="en-US"&&t.city){const e=y.counties.findIndex(l=>l===t.city);return console.log(t.city),console.log(e),y.districts[e][0]||""}else return null});h(()=>u.value,()=>{t.city="",t.district=""}),h(()=>t.city,()=>{if(t.district="",u.value==="zh-TW"){const e=r.counties.findIndex(l=>l===t.city);e>-1&&(a.city=e)}else{const e=y.counties.findIndex(l=>l===t.city);e>-1&&(a.city=e)}}),h(()=>t.district,()=>{if(u.value==="zh-TW"){console.log(a.city);const e=r.districts[a.city][0].findIndex(l=>l===t.district);console.log(a.city),console.log(e),e>-1&&(a.district=e,t.zipcode=r.districts[a.city][1][e])}else{const e=y.districts[a.city][0].findIndex(l=>l===t.district);e>-1&&(a.district=e,t.zipcode=r.districts[a.city][1][e])}});const N=async()=>{V.value=!0;try{t.date_from=t.date.from,t.date_to=t.date.to,u.value==="en-US"&&(t.city=r.counties[a.city],t.district=r.districts[a.city][0][a.district]);const e=new FormData;for(const l in t)if(l==="photos")for(let o=0;o<t[l].length;o++)e.append(l,t[l][o]);else if(l==="welfare")for(let o=0;o<t[l].length;o++)e.append(l,t[l][o]);else e.append(l,t[l]);await oe.post("/jobs",e),await I.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"}),C.push("/admin/jobs")}catch(e){console.log(e),I.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError&&e.response.data?e.response.data.message:"\u767C\u751F\u932F\u8AA4"})}V.value=!1};return(e,l)=>(p(),k(L,{id:"post_jobs"},{default:d(()=>[s("div",ne,[s("h2",re,c(e.$t("new_jobs")),1),i(M,{inset:"",class:"q-mb-lg"}),s("div",de,[i(ae,{autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false",onSubmit:X(N,["prevent"])},{default:d(()=>[s("div",ue,[s("div",ce,[i(H,{modelValue:t.is_shown,"onUpdate:modelValue":l[0]||(l[0]=o=>t.is_shown=o),label:t.is_shown?e.$t("is_shown"):e.$t("is_not_shown")},null,8,["modelValue","label"])])]),s("div",null,[i(f,{outlined:"",modelValue:t.title,"onUpdate:modelValue":l[1]||(l[1]=o=>t.title=o),label:e.$t("job_title")+"*",rules:m.title},null,8,["modelValue","label","rules"]),i(f,{outlined:"",modelValue:w.value,"onUpdate:modelValue":l[3]||(l[3]=o=>w.value=o),rules:m.required,label:e.$t("job_time")},{append:d(()=>[i(j,{name:"event",class:"cursor-pointer"},{default:d(()=>[i(se,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:d(()=>[i(J,{modelValue:t.date,"onUpdate:modelValue":l[2]||(l[2]=o=>t.date=o),range:""},{default:d(()=>[s("div",me,[G(i(x,{label:"Close",color:"primary",flat:""},null,512),[[Y]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules","label"]),i(S,{outlined:"",modelValue:t.city,"onUpdate:modelValue":l[4]||(l[4]=o=>t.city=o),options:b(E),label:e.$t("city")+"*","emit-value":"","lazy-rules":"",rules:m.required},null,8,["modelValue","options","label","rules"]),i(S,{outlined:"",modelValue:t.district,"onUpdate:modelValue":l[5]||(l[5]=o=>t.district=o),options:b(F),label:e.$t("district")+"*","emit-value":"",rules:m.required},null,8,["modelValue","options","label","rules"]),i(f,{outlined:"",type:"text",modelValue:t.address,"onUpdate:modelValue":l[6]||(l[6]=o=>t.address=o),label:e.$t("address")+"*","lazy-rules":"",rules:m.address},null,8,["modelValue","label","rules"])]),s("div",null,[s("h5",null,c(e.$t("job_welfare")),1),s("div",pe,[(p(!0),v(z,null,U(b(P),(o,_)=>(p(),k(ee,{key:_,modelValue:t.welfare,"onUpdate:modelValue":l[7]||(l[7]=W=>t.welfare=W),val:o.value,label:o.label},null,8,["modelValue","val","label"]))),128))])]),s("div",null,[s("h5",null,c(e.$t("job_week_hours")),1),i(f,{modelValue:t.week_hours,"onUpdate:modelValue":l[8]||(l[8]=o=>t.week_hours=o),modelModifiers:{number:!0},type:"number",filled:"",rules:m.required},{append:d(()=>[s("p",fe,c(e.$t("hours_a_week")),1)]),_:1},8,["modelValue","rules"])]),s("div",null,[s("h5",null,c(e.$t("job_description")),1),i(b(te),{content:t.description,"onUpdate:content":l[9]||(l[9]=o=>t.description=o),contentType:"html",theme:"snow",toolbar:"minimal",placeholder:e.$t("write_down_what_the_helpers_need_to_do")},null,8,["content","placeholder"])]),s("div",null,[b(D)?(p(),v("h5",be,c(e.$t("photos_host")),1)):K("",!0),i(ie,{color:"primary",accept:".jpg, image/*","max-files":3,filled:"",multiple:"",modelValue:t.photos,"onUpdate:modelValue":l[10]||(l[10]=o=>t.photos=o),label:e.$t("upload_file"),hint:"\u6700\u591A\u4E0A\u50B33\u5F35"},{prepend:d(()=>[i(j,{name:"cloud_upload"})]),_:1},8,["modelValue","label"]),s("div",ye,[(p(!0),v(z,null,U(e.photos,(o,_)=>(p(),v("div",{class:"col-6 q-pa-xs",key:_},[i(le,{src:o,ratio:4/3,"spinner-color":"white"},null,8,["src"])]))),128))])]),s("div",null,[s("h5",null,c(e.$t("job_question")),1),i(f,{modelValue:t.question,"onUpdate:modelValue":l[11]||(l[11]=o=>t.question=o),filled:"",type:"textarea",hint:e.$t("job_question_hint")},null,8,["modelValue","hint"])]),i(x,{class:"full-width q-mt-xl",color:"primary",label:e.$t("submit"),type:"submit",loading:V.value},null,8,["label","loading"])]),_:1},8,["onSubmit"])])])]),_:1}))}};export{Qe as default};
