import{N as D,aJ as A,O as H,u as K,s as X,r as b,a as g,P as V,p as $,o as y,S as z,w as c,l as G,aK as I,f as a,T as n,e as o,bv as ee,j as w,k as S,t as te,i as T,W as _,aN as C,d as k,aL as F,F as E,b8 as le,U as se,X as oe,Y as ie,bt as ae,_ as N}from"./index.fa303fc3.js";import{d as r,a as p,Q as re,b as ne}from"./data-zh.752466a4.js";import{Q as B}from"./QSelect.40ba4c1b.js";import{Q as de}from"./QFile.79526d11.js";import{Q as ue}from"./QImg.dfc659b4.js";import{Q as ce}from"./QForm.797c3076.js";import"./QChip.380e3246.js";const me={class:"q-pa-md",style:{"min-width":"500px"}},pe={class:"row items-center justify-end"},fe={class:"q-gutter-sm"},ye={style:{"font-size":"1rem",margin:"0"}},he={key:0},be={class:"q-pa-md flex row"},Ue={__name:"EditJob",setup(we){const{locale:u}=D({useScope:"global"}),{t:d}=D(),U=A(),M=H(),P=K(),{role:W,isHost:J}=X(P),x=b(null),v=b(""),j=b(""),q=b(!1);b(!0),g([]);const i=g({city:"",district:""}),t=g({_id:"",title:"",date:{},date_from:"",date_to:"",welfare:[],city:"",district:"",address:"",zipcode:"",role:W.value,description:"",photos:[],question:"",week_hours:10,is_shown:!0});V(()=>t.date,()=>{v.value=t.date.from+"~"+t.date.to});const L=$(()=>[{label:d("accommodation"),value:"accommodation"},{label:d("vehicle"),value:"vehicle"},{label:d("pocket_money"),value:"pocket_money"},{label:d("insurance"),value:"insurance"},{label:d("free_course"),value:"free_course"},{label:d("meal"),value:"meal"}]),f=g({title:[e=>!!e||d("required"),e=>e.length>=2&&e.length<=30||"\u540D\u7A31\u9577\u5EA6\u70BA 2 \u5230 30 \u500B\u5B57"],address:[e=>!!e||d("required"),e=>e.length>=5||"\u8ACB\u586B\u5BEB\u6B63\u78BA\u8A73\u7D30\u5730\u5740\u8CC7\u8A0A"],required:[e=>!!e||d("required")]}),O=$(()=>u.value==="zh-TW"?r.counties:p.counties),R=$(()=>{if(u.value==="zh-TW"&&t.city){const e=r.counties.findIndex(l=>l===t.city);return r.districts[e][0]}else if(u.value==="en-US"&&t.city){const e=p.counties.findIndex(l=>l===t.city);return console.log(t.city),console.log(e),p.districts[e][0]||""}else return null});V(()=>u.value,()=>{t.city="",t.district=""}),V(()=>t.city,()=>{if(u.value==="zh-TW"){const e=r.counties.findIndex(l=>l===t.city);e>-1&&(i.city=e)}else{const e=p.counties.findIndex(l=>l===t.city);e>-1&&(i.city=e)}}),V(()=>t.district,()=>{if(u.value==="zh-TW"){const e=r.districts[i.city][0].findIndex(l=>l===t.district);e>-1&&(i.district=e,t.zipcode=r.districts[i.city][1][e])}else{const e=p.districts[i.city][0].findIndex(l=>l===t.district);e>-1&&(i.district=e,t.zipcode=r.districts[i.city][1][e])}}),(async()=>{try{const{data:e}=await I.get("/jobs/"+U.params.id);t._id=e.result._id,t.title=e.result.title,t.city=e.result.city,t.district=e.result.district,t.address=e.result.address,t.zipcode=e.result.zipcode,t.description=e.result.description,x.value.setHTML(t.description),j.value=e.result.photos,t.welfare=e.result.welfare,t.week_hours=e.result.week_hours,t.published_time=e.result.published_time,t.question=e.result.question,t.is_shown=e.result.is_shown;let l=new Date(e.result.date_from).getFullYear(),s=new Date(e.result.date_from).getMonth()+1,m=new Date(e.result.date_from).getDate();if(t.date.from=l+"/"+s+"/"+m,l=new Date(e.result.date_to).getFullYear(),s=new Date(e.result.date_to).getMonth()+1,m=new Date(e.result.date_to).getDate(),t.date.to=l+"/"+s+"/"+m,v.value=t.date.from+"~"+t.date.to,u.value==="en-US"){const h=r.counties.findIndex(Q=>Q===e.result.city);t.city=p.counties[h];const Z=r.districts[h][0].findIndex(Q=>Q===e.result.district);t.district=p.districts[h][0][Z]}}catch(e){console.log(e)}})();const Y=async()=>{q.value=!0;try{t.date_from=t.date.from,t.date_to=t.date.to,u.value==="en-US"&&(t.city=r.counties[i.city],t.district=r.districts[i.city][0][i.district]);const e=new FormData;for(const l in t)if(l==="photos"){if(console.log(t[l].length),t[l].length>0)for(let s=0;s<t[l].length;s++)e.append(l,t[l][s])}else if(l==="welfare")for(let s=0;s<t[l].length;s++)e.append(l,t[l][s]);else e.append(l,t[l]);await I.patch("/jobs/"+U.params.id,e),await N.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),M.push("/admin/jobs")}catch(e){console.log(e),N.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError&&e.response.data?e.response.data.message:"\u767C\u751F\u932F\u8AA4"})}q.value=!1};return(e,l)=>(y(),z(G,{id:"post_jobs",class:"flex flex-center column"},{default:c(()=>[a("h4",null,n(e.$t("edit_jobs")),1),a("div",me,[o(ce,{autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false",onSubmit:oe(Y,["prevent"])},{default:c(()=>[o(ee,{modelValue:t.is_shown,"onUpdate:modelValue":l[0]||(l[0]=s=>t.is_shown=s),label:t.is_shown?e.$t("is_shown"):e.$t("is_not_shown")},null,8,["modelValue","label"]),o(w,{outlined:"",modelValue:t.title,"onUpdate:modelValue":l[1]||(l[1]=s=>t.title=s),label:e.$t("job_title")+"*",rules:f.title},null,8,["modelValue","label","rules"]),o(w,{outlined:"",modelValue:v.value,"onUpdate:modelValue":l[3]||(l[3]=s=>v.value=s),rules:f.required,label:e.$t("job_time")},{append:c(()=>[o(S,{name:"event",class:"cursor-pointer"},{default:c(()=>[o(re,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:c(()=>[o(ne,{modelValue:t.date,"onUpdate:modelValue":l[2]||(l[2]=s=>t.date=s),range:""},{default:c(()=>[a("div",pe,[te(o(T,{label:"Close",color:"primary",flat:""},null,512),[[ie]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules","label"]),o(B,{outlined:"",modelValue:t.city,"onUpdate:modelValue":l[4]||(l[4]=s=>t.city=s),options:_(O),label:e.$t("city")+"*","emit-value":"","lazy-rules":"",rules:f.required},null,8,["modelValue","options","label","rules"]),o(B,{outlined:"",modelValue:t.district,"onUpdate:modelValue":l[5]||(l[5]=s=>t.district=s),options:_(R),label:e.$t("district")+"*","emit-value":"",rules:f.required},null,8,["modelValue","options","label","rules"]),C(" "+n(i.city),1),o(w,{outlined:"",type:"text",modelValue:t.address,"onUpdate:modelValue":l[6]||(l[6]=s=>t.address=s),label:e.$t("address")+"*","lazy-rules":"",rules:f.address},null,8,["modelValue","label","rules"]),a("h5",null,n(e.$t("job_welfare")),1),a("div",fe,[(y(!0),k(E,null,F(_(L),(s,m)=>(y(),z(ae,{key:m,modelValue:t.welfare,"onUpdate:modelValue":l[7]||(l[7]=h=>t.welfare=h),val:s.value,label:s.label},null,8,["modelValue","val","label"]))),128))]),a("h5",null,n(e.$t("job_week_hours")),1),o(w,{modelValue:t.week_hours,"onUpdate:modelValue":l[8]||(l[8]=s=>t.week_hours=s),modelModifiers:{number:!0},type:"number",filled:"",rules:f.required},{append:c(()=>[a("p",ye,n(e.$t("hours_a_week")),1)]),_:1},8,["modelValue","rules"]),a("h5",null,n(e.$t("job_description")),1),o(_(le),{content:t.description,"onUpdate:content":l[9]||(l[9]=s=>t.description=s),contentType:"html",theme:"snow",toolbar:"minimal",placeholder:e.$t("write_down_what_the_helpers_need_to_do"),ref_key:"a",ref:x},null,8,["content","placeholder"]),C(" "+n(t.description)+" ",1),a("pre",null,n(t),1),_(J)?(y(),k("h5",he,n(e.$t("photos_host")),1)):se("",!0),o(de,{color:"primary",accept:".jpg, image/*","max-files":3,filled:"",multiple:"",modelValue:t.photos,"onUpdate:modelValue":l[10]||(l[10]=s=>t.photos=s),label:e.$t("upload_file"),hint:"\u6700\u591A\u4E0A\u50B33\u5F35"},{prepend:c(()=>[o(S,{name:"cloud_upload"})]),_:1},8,["modelValue","label"]),a("div",be,[(y(!0),k(E,null,F(j.value,(s,m)=>(y(),k("div",{class:"col-6 q-pa-xs",key:m},[o(ue,{src:s,ratio:4/3,"spinner-color":"white"},null,8,["src"])]))),128))]),a("h5",null,n(e.$t("job_question")),1),o(w,{modelValue:t.question,"onUpdate:modelValue":l[11]||(l[11]=s=>t.question=s),filled:"",type:"textarea",hint:e.$t("job_question_hint")},null,8,["modelValue","hint"]),o(T,{class:"full-width",color:"primary",label:e.$t("submit"),type:"submit",loading:q.value},null,8,["label","loading"])]),_:1},8,["onSubmit"])])]),_:1}))}};export{Ue as default};
