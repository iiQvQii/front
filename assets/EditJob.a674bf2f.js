import{X as j,aN as A,Y as H,u as L,s as X,r as b,a as g,p as V,D as $,o as y,Z as z,w as u,l as G,aO as I,f as r,t as c,e as o,bv as K,j as w,k as S,E as ee,i as T,a0 as _,aS as te,d as k,aP as C,F as E,bd as le,_ as se,a1 as oe,a2 as ie,bt as ae,aQ as re,a4 as F}from"./index.c53e1e06.js";import{d as a,a as p,Q as ne,b as de}from"./data-zh.0cb8ff3e.js";import{Q as B}from"./QSelect.827642bc.js";import{Q as ue}from"./QFile.bcfdc53f.js";import{Q as ce}from"./QForm.e28fb361.js";import"./QChip.8a9934e9.js";const me={class:"q-pa-md",style:{"min-width":"500px"}},pe={class:"row items-center justify-end"},fe={class:"q-gutter-sm"},ye={style:{"font-size":"1rem",margin:"0"}},he={key:0},be={class:"q-pa-md flex row"},$e={__name:"EditJob",setup(we){const{locale:d}=j({useScope:"global"}),{t:n}=j(),x=A(),M=H(),N=L(),{role:P,isHost:W}=X(N),D=b(null),v=b(""),U=b(""),q=b(!1);b(!0),g([]);const i=g({city:"",district:""}),t=g({_id:"",title:"",date:{},date_from:"",date_to:"",welfare:[],city:"",district:"",address:"",zipcode:"",role:P.value,description:"",photos:[],question:"",week_hours:10,is_shown:!0});V(()=>t.date,()=>{v.value=t.date.from+"~"+t.date.to});const Z=$(()=>[{label:n("accommodation"),value:"accommodation"},{label:n("vehicle"),value:"vehicle"},{label:n("pocket_money"),value:"pocket_money"},{label:n("insurance"),value:"insurance"},{label:n("free_course"),value:"free_course"},{label:n("meal"),value:"meal"}]),f=g({title:[e=>!!e||n("required"),e=>e.length>=2&&e.length<=30||"\u540D\u7A31\u9577\u5EA6\u70BA 2 \u5230 30 \u500B\u5B57"],address:[e=>!!e||n("required"),e=>e.length>=5||"\u8ACB\u586B\u5BEB\u6B63\u78BA\u8A73\u7D30\u5730\u5740\u8CC7\u8A0A"],required:[e=>!!e||n("required")]}),J=$(()=>d.value==="zh-TW"?a.counties:p.counties),O=$(()=>{if(d.value==="zh-TW"&&t.city){const e=a.counties.findIndex(l=>l===t.city);return a.districts[e][0]}else if(d.value==="en-US"&&t.city){const e=p.counties.findIndex(l=>l===t.city);return console.log(t.city),console.log(e),p.districts[e][0]||""}else return null});V(()=>d.value,()=>{t.city="",t.district=""}),V(()=>t.city,()=>{if(d.value==="zh-TW"){const e=a.counties.findIndex(l=>l===t.city);e>-1&&(i.city=e)}else{const e=p.counties.findIndex(l=>l===t.city);e>-1&&(i.city=e)}}),V(()=>t.district,()=>{if(d.value==="zh-TW"){const e=a.districts[i.city][0].findIndex(l=>l===t.district);e>-1&&(i.district=e,t.zipcode=a.districts[i.city][1][e])}else{const e=p.districts[i.city][0].findIndex(l=>l===t.district);e>-1&&(i.district=e,t.zipcode=a.districts[i.city][1][e])}}),(async()=>{try{const{data:e}=await I.get("/jobs/"+x.params.id);t._id=e.result._id,t.title=e.result.title,t.city=e.result.city,t.district=e.result.district,t.address=e.result.address,t.zipcode=e.result.zipcode,t.description=e.result.description,D.value.setHTML(t.description),U.value=e.result.photos,t.welfare=e.result.welfare,t.week_hours=e.result.week_hours,t.published_time=e.result.published_time,t.question=e.result.question,t.is_shown=e.result.is_shown;let l=new Date(e.result.date_from).getFullYear(),s=new Date(e.result.date_from).getMonth()+1,m=new Date(e.result.date_from).getDate();if(t.date.from=l+"/"+s+"/"+m,l=new Date(e.result.date_to).getFullYear(),s=new Date(e.result.date_to).getMonth()+1,m=new Date(e.result.date_to).getDate(),t.date.to=l+"/"+s+"/"+m,v.value=t.date.from+"~"+t.date.to,d.value==="en-US"){const h=a.counties.findIndex(Q=>Q===e.result.city);t.city=p.counties[h];const Y=a.districts[h][0].findIndex(Q=>Q===e.result.district);t.district=p.districts[h][0][Y]}}catch(e){console.log(e)}})();const R=async()=>{q.value=!0;try{t.date_from=t.date.from,t.date_to=t.date.to,d.value==="en-US"&&(t.city=a.counties[i.city],t.district=a.districts[i.city][0][i.district]);const e=new FormData;for(const l in t)if(l==="photos"){if(console.log(t[l].length),t[l].length>0)for(let s=0;s<t[l].length;s++)e.append(l,t[l][s])}else if(l==="welfare")for(let s=0;s<t[l].length;s++)e.append(l,t[l][s]);else e.append(l,t[l]);await I.patch("/jobs/"+x.params.id,e),await F.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),M.push("/admin/jobs")}catch(e){console.log(e),F.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError&&e.response.data?e.response.data.message:"\u767C\u751F\u932F\u8AA4"})}q.value=!1};return(e,l)=>(y(),z(G,{id:"post_jobs",class:"flex flex-center column"},{default:u(()=>[r("h4",null,c(e.$t("edit_jobs")),1),r("div",me,[o(ce,{autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false",onSubmit:oe(R,["prevent"])},{default:u(()=>[o(K,{modelValue:t.is_shown,"onUpdate:modelValue":l[0]||(l[0]=s=>t.is_shown=s),label:t.is_shown?e.$t("is_shown"):e.$t("is_not_shown")},null,8,["modelValue","label"]),o(w,{outlined:"",modelValue:t.title,"onUpdate:modelValue":l[1]||(l[1]=s=>t.title=s),label:e.$t("job_title")+"*",rules:f.title},null,8,["modelValue","label","rules"]),o(w,{outlined:"",modelValue:v.value,"onUpdate:modelValue":l[3]||(l[3]=s=>v.value=s),rules:f.required,label:e.$t("job_time")},{append:u(()=>[o(S,{name:"event",class:"cursor-pointer"},{default:u(()=>[o(ne,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:u(()=>[o(de,{modelValue:t.date,"onUpdate:modelValue":l[2]||(l[2]=s=>t.date=s),range:""},{default:u(()=>[r("div",pe,[ee(o(T,{label:"Close",color:"primary",flat:""},null,512),[[ie]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules","label"]),o(B,{outlined:"",modelValue:t.city,"onUpdate:modelValue":l[4]||(l[4]=s=>t.city=s),options:_(J),label:e.$t("city")+"*","emit-value":"","lazy-rules":"",rules:f.required},null,8,["modelValue","options","label","rules"]),o(B,{outlined:"",modelValue:t.district,"onUpdate:modelValue":l[5]||(l[5]=s=>t.district=s),options:_(O),label:e.$t("district")+"*","emit-value":"",rules:f.required},null,8,["modelValue","options","label","rules"]),te(" "+c(i.city),1),o(w,{outlined:"",type:"text",modelValue:t.address,"onUpdate:modelValue":l[6]||(l[6]=s=>t.address=s),label:e.$t("address")+"*","lazy-rules":"",rules:f.address},null,8,["modelValue","label","rules"]),r("h5",null,c(e.$t("job_welfare")),1),r("div",fe,[(y(!0),k(E,null,C(_(Z),(s,m)=>(y(),z(ae,{key:m,modelValue:t.welfare,"onUpdate:modelValue":l[7]||(l[7]=h=>t.welfare=h),val:s.value,label:s.label},null,8,["modelValue","val","label"]))),128))]),r("h5",null,c(e.$t("job_week_hours")),1),o(w,{modelValue:t.week_hours,"onUpdate:modelValue":l[8]||(l[8]=s=>t.week_hours=s),modelModifiers:{number:!0},type:"number",filled:"",rules:f.required},{append:u(()=>[r("p",ye,c(e.$t("hours_a_week")),1)]),_:1},8,["modelValue","rules"]),r("h5",null,c(e.$t("job_description")),1),o(_(le),{content:t.description,"onUpdate:content":l[9]||(l[9]=s=>t.description=s),contentType:"html",theme:"snow",toolbar:"minimal",placeholder:e.$t("write_down_what_the_helpers_need_to_do"),ref_key:"a",ref:D},null,8,["content","placeholder"]),_(W)?(y(),k("h5",he,c(e.$t("photos_host")),1)):se("",!0),o(ue,{color:"primary",accept:".jpg, image/*","max-files":3,filled:"",multiple:"",modelValue:t.photos,"onUpdate:modelValue":l[10]||(l[10]=s=>t.photos=s),label:e.$t("upload_file"),hint:"\u6700\u591A\u4E0A\u50B33\u5F35"},{prepend:u(()=>[o(S,{name:"cloud_upload"})]),_:1},8,["modelValue","label"]),r("div",be,[(y(!0),k(E,null,C(U.value,(s,m)=>(y(),k("div",{class:"col-6 q-pa-xs",key:m},[o(re,{src:s,ratio:4/3,"spinner-color":"white"},null,8,["src"])]))),128))]),r("h5",null,c(e.$t("job_question")),1),o(w,{modelValue:t.question,"onUpdate:modelValue":l[11]||(l[11]=s=>t.question=s),filled:"",type:"textarea",hint:e.$t("job_question_hint")},null,8,["modelValue","hint"]),o(T,{class:"full-width",color:"primary",label:e.$t("submit"),type:"submit",loading:q.value},null,8,["label","loading"])]),_:1},8,["onSubmit"])])]),_:1}))}};export{$e as default};
