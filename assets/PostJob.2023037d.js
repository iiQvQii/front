import{S as $,aL as R,T as Z,u as M,s as O,r as g,j as q,w as h,x as Q,k as p,U as k,p as d,Q as A,t as s,V as u,n as i,aK as L,bw as H,X as f,y as j,z as J,v as x,Z as b,aR as K,m as v,aN as U,F as z,W as X,_ as G,$ as Y,bu as ee,bj as te,aO as le,aM as oe,a1 as S}from"./index.a83dd0ef.js";import{d as r,a as y,Q as se,b as ie}from"./data-zh.189b540f.js";import{Q as I}from"./QSelect.28e834e1.js";import{Q as ae}from"./QFile.af1aad65.js";import{Q as ne}from"./QForm.ba52d117.js";import"./QChip.72097029.js";const re={class:"q-pa-xl q-mx-auto"},de={class:"text-center"},ue={class:"q-mx-auto form_container"},ce={class:"row justify-end"},me={class:"col q-pb-md text-right text-weight-bold"},pe={class:"row items-center justify-end"},fe={class:"q-gutter-sm"},be={style:{"font-size":"1rem",margin:"0"}},ye={key:0},he={class:"q-pa-md flex row"},$e={__name:"PostJob",setup(ve){const{locale:c}=$({useScope:"global"}),{t:n}=$();R();const T=Z(),C=M(),{role:D,isHost:B}=O(C),w=g(""),V=g(!1);g(!0);const a=q({city:"",district:""}),t=q({_id:"",title:"",date:{},date_from:"",date_to:"",welfare:[],city:"",district:"",address:"",zipcode:"",role:D.value,description:"?",photos:[],question:"1. \u8ACB\u554F\u4F60\u70BA\u4EC0\u9EBC\u60F3\u8981\u4F86",week_hours:10,is_shown:!0});h(()=>t.date,()=>{w.value=t.date.from+"~"+t.date.to});const E=Q(()=>[{label:n("accommodation"),value:"accommodation"},{label:n("vehicle"),value:"vehicle"},{label:n("pocket_money"),value:"pocket_money"},{label:n("insurance"),value:"insurance"},{label:n("free_course"),value:"free_course"},{label:n("meal"),value:"meal"}]),m=q({title:[e=>!!e||n("required"),e=>e.length>=2&&e.length<=30||"\u540D\u7A31\u9577\u5EA6\u70BA 2 \u5230 30 \u500B\u5B57"],address:[e=>!!e||n("required"),e=>e.length>=5||"\u8ACB\u586B\u5BEB\u6B63\u78BA\u8A73\u7D30\u5730\u5740\u8CC7\u8A0A"],required:[e=>!!e||n("required")]}),F=Q(()=>c.value==="zh-TW"?r.counties:y.counties),N=Q(()=>{if(c.value==="zh-TW"&&t.city){const e=r.counties.findIndex(l=>l===t.city);return r.districts[e][0]}else if(c.value==="en-US"&&t.city){const e=y.counties.findIndex(l=>l===t.city);return console.log(t.city),console.log(e),y.districts[e][0]||""}else return null});h(()=>c.value,()=>{t.city="",t.district=""}),h(()=>t.city,()=>{if(t.district="",c.value==="zh-TW"){const e=r.counties.findIndex(l=>l===t.city);e>-1&&(a.city=e)}else{const e=y.counties.findIndex(l=>l===t.city);e>-1&&(a.city=e)}}),h(()=>t.district,()=>{if(c.value==="zh-TW"){console.log(a.city);const e=r.districts[a.city][0].findIndex(l=>l===t.district);console.log(a.city),console.log(e),e>-1&&(a.district=e,t.zipcode=r.districts[a.city][1][e])}else{const e=y.districts[a.city][0].findIndex(l=>l===t.district);e>-1&&(a.district=e,t.zipcode=r.districts[a.city][1][e])}});const P=async()=>{V.value=!0;try{t.date_from=t.date.from,t.date_to=t.date.to,c.value==="en-US"&&(t.city=r.counties[a.city],t.district=r.districts[a.city][0][a.district]);const e=new FormData;for(const l in t)if(l==="photos")for(let o=0;o<t[l].length;o++)e.append(l,t[l][o]);else if(l==="welfare")for(let o=0;o<t[l].length;o++)e.append(l,t[l][o]);else e.append(l,t[l]);await oe.post("/jobs",e),await S.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"}),T.push("/admin/jobs")}catch(e){console.log(e),S.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError&&e.response.data?e.response.data.message:"\u767C\u751F\u932F\u8AA4"})}V.value=!1};return(e,l)=>(p(),k(A,{id:"post_jobs"},{default:d(()=>[s("div",re,[s("h3",de,u(e.$t("new_jobs")),1),i(L,{inset:"",class:"q-mb-lg"}),s("div",ue,[i(ne,{autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false",onSubmit:G(P,["prevent"])},{default:d(()=>[s("div",ce,[s("div",me,[i(H,{modelValue:t.is_shown,"onUpdate:modelValue":l[0]||(l[0]=o=>t.is_shown=o),label:t.is_shown?e.$t("is_shown"):e.$t("is_not_shown")},null,8,["modelValue","label"])])]),s("div",null,[i(f,{outlined:"",modelValue:t.title,"onUpdate:modelValue":l[1]||(l[1]=o=>t.title=o),label:e.$t("job_title")+"*",rules:m.title},null,8,["modelValue","label","rules"]),i(f,{outlined:"",modelValue:w.value,"onUpdate:modelValue":l[3]||(l[3]=o=>w.value=o),rules:m.required,label:e.$t("job_time")},{append:d(()=>[i(j,{name:"event",class:"cursor-pointer"},{default:d(()=>[i(se,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:d(()=>[i(ie,{modelValue:t.date,"onUpdate:modelValue":l[2]||(l[2]=o=>t.date=o),range:""},{default:d(()=>[s("div",pe,[J(i(x,{label:"Close",color:"primary",flat:""},null,512),[[Y]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules","label"]),i(I,{outlined:"",modelValue:t.city,"onUpdate:modelValue":l[4]||(l[4]=o=>t.city=o),options:b(F),label:e.$t("city")+"*","emit-value":"","lazy-rules":"",rules:m.required},null,8,["modelValue","options","label","rules"]),i(I,{outlined:"",modelValue:t.district,"onUpdate:modelValue":l[5]||(l[5]=o=>t.district=o),options:b(N),label:e.$t("district")+"*","emit-value":"",rules:m.required},null,8,["modelValue","options","label","rules"]),K(" "+u(a.city),1),i(f,{outlined:"",type:"text",modelValue:t.address,"onUpdate:modelValue":l[6]||(l[6]=o=>t.address=o),label:e.$t("address")+"*","lazy-rules":"",rules:m.address},null,8,["modelValue","label","rules"])]),s("div",null,[s("h5",null,u(e.$t("job_welfare")),1),s("div",fe,[(p(!0),v(z,null,U(b(E),(o,_)=>(p(),k(ee,{key:_,modelValue:t.welfare,"onUpdate:modelValue":l[7]||(l[7]=W=>t.welfare=W),val:o.value,label:o.label},null,8,["modelValue","val","label"]))),128))])]),s("div",null,[s("h5",null,u(e.$t("job_week_hours")),1),i(f,{modelValue:t.week_hours,"onUpdate:modelValue":l[8]||(l[8]=o=>t.week_hours=o),modelModifiers:{number:!0},type:"number",filled:"",rules:m.required},{append:d(()=>[s("p",be,u(e.$t("hours_a_week")),1)]),_:1},8,["modelValue","rules"])]),s("div",null,[s("h5",null,u(e.$t("job_description")),1),i(b(te),{content:t.description,"onUpdate:content":l[9]||(l[9]=o=>t.description=o),contentType:"html",theme:"snow",toolbar:"minimal",placeholder:e.$t("write_down_what_the_helpers_need_to_do")},null,8,["content","placeholder"])]),s("div",null,[b(B)?(p(),v("h5",ye,u(e.$t("photos_host")),1)):X("",!0),i(ae,{color:"primary",accept:".jpg, image/*","max-files":3,filled:"",multiple:"",modelValue:t.photos,"onUpdate:modelValue":l[10]||(l[10]=o=>t.photos=o),label:e.$t("upload_file"),hint:"\u6700\u591A\u4E0A\u50B33\u5F35"},{prepend:d(()=>[i(j,{name:"cloud_upload"})]),_:1},8,["modelValue","label"]),s("div",he,[(p(!0),v(z,null,U(e.photos,(o,_)=>(p(),v("div",{class:"col-6 q-pa-xs",key:_},[i(le,{src:o,ratio:4/3,"spinner-color":"white"},null,8,["src"])]))),128))])]),s("div",null,[s("h5",null,u(e.$t("job_question")),1),i(f,{modelValue:t.question,"onUpdate:modelValue":l[11]||(l[11]=o=>t.question=o),filled:"",type:"textarea",hint:e.$t("job_question_hint")},null,8,["modelValue","hint"])]),i(x,{class:"full-width q-mt-xl",color:"primary",label:e.$t("submit"),type:"submit",loading:V.value},null,8,["label","loading"])]),_:1},8,["onSubmit"])])])]),_:1}))}};export{$e as default};
